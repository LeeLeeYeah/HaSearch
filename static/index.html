<!DOCTYPE HTML>
<html>

<head>
	<title>HaSearch</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- CSS -->
	<link href="static/css/my.css" rel='stylesheet' type='text/css' />
	<link href="static/css/bootstrap.min.css" rel='stylesheet' type='text/css' />
	<!-- JQuery -->
	<script src="static/js/jquery.min.js"></script>
	<!-- React JavaScript -->
	<script src="static/js/react.js"></script>
	<script src="static/js/react-dom.js"></script>
	<script src="static/js/browser.min.js"></script>
</head>

<body>
	<div id='container'></div>
	<script type='text/babel'>
		const enterKeycode = 13;

		var Results = React.createClass({
			render: function(){
				return(
					<ul>{
						this.props.data.map(function(value,i){
							return(
								<li key={i}>
									{value}
								</li>
							);
						});
					}</ul>
				);
			}
		});

		var MainFrame = React.createClass({
			getInitialState:function(){
				return{
					stage:'prepare',
					input:'',
					correct:'',
					time:0,
					resList:[]
				}
			},
			runSearch: function(input){
				$.get('/api/correct?word='+this.state.input).done(
					function(result){
						var res = JSON.parse(res);
						if(res.status===1){
							this.setState(correct:res.correct);
						}
					}.bind(this)
				)
				this.setState({stage:'show'});
			},
			render: function(){
				if(this.state.stage==='prepare'){
					return(
						<div className="indexFrame">
							<div className="firstLogoDiv">
								<img className="firstLogo" src="static/images/logo.jpg" alt="HaSearch"/>
							</div>
							<div className="searchInputWrapper">
								<AutoSuggest runSearch={this.runSearch}/>
								<div className='buttonsWrapper'>
									<input className="myBtn" type="button" value="Row" onClick={this.runSearch}/>
								</div>
							</div>
						</div>
					);
				}else{
					return(
						<div className="resultFrame">
							<div className="searchBar">
								<div className="smLogo"><img className="smLogo" src="static/images/smLogo.png" alt="HaSearch"/></div>
								<div><input className='continueWords' type="text"/></div>
								<div><input type="button" className="myBtn1" value="H"></input></div>
							</div>
							<div className="resultList">
								<p id="searchTime">About {this.state.resList.length} results ({this.state.time} seconds)</p>
								<span className="searchTip">Did you mean?</span>
								<br/>
								<span className="promptWords">{this.state.correct}</span>
								<hr></hr>
								<Results data={this.state.resList}/>
							</div>
						</div>
					);
				}
			}
		});
		var AutoSuggest = React.createClass({
			getInitialState:function(){
				return{
					input:''
				};
			},
			onKeyDown:function(event){
				if(event.KeyCode==13){
					this.props.runSearch(this.state.input);
				}
			},
			onChange:function(event){
				this.setState({input:event.target.value});
			},
			render: function(){
				return(<input className='initWords' type="text" onKeyDown={this.onKeyDown} onChange={this.onChange}/>);
			}
		});

		// render
		ReactDOM.render(<MainFrame/>,document.getElementById('container'));
	</script>
</body>
</html>
